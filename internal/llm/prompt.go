package llm

import (
	"encoding/json"
	"fmt"
	"strings"

	"github.com/BetterCallFirewall/Hackerecon/internal/models"
)

// formatJSON —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π JSON –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫ –≤ JSON –æ—Ç–≤–µ—Ç–µ LLM
func formatJSON(data interface{}) string {
	result, _ := json.Marshal(data) // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –±–µ–∑ –æ—Ç—Å—Ç—É–ø–æ–≤
	return string(result)
}

// formatHeaders —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ JSON-ready —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON –æ–±—ä–µ–∫—Ç –∫–æ—Ç–æ—Ä—ã–π –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –ª–µ–≥–∫–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
func formatHeaders(headers map[string]string) string {
	if len(headers) == 0 {
		return "{}"
	}

	// –ò—Å–ø–æ–ª—å–∑—É–µ–º json.Marshal –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON
	result, err := json.Marshal(headers)
	if err != nil {
		return "{}"
	}
	return string(result)
}

// BuildSecurityAnalysisPrompt —Å–æ–∑–¥–∞—ë—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Ö–Ω–∏–∫–∏ –ø—Ä–æ–º–ø—Ç–∏–Ω–≥–∞: role playing, few-shot examples, structured output
func BuildSecurityAnalysisPrompt(req *models.SecurityAnalysisRequest) string {
	extractedDataJson := formatJSON(req.ExtractedData)

	blacklist := `## –ß–¢–û –ù–ï –£–ü–û–ú–ò–ù–ê–¢–¨ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–ì–ù–û–†–ò–†–û–í–ê–¢–¨)

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 1: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏ (–Ω–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
–ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å:
- –ë—Ä—É—Ç—Ñ–æ—Ä—Å –ø–∞—Ä–æ–ª–µ–π / credential stuffing
- –°–æ–∑–¥–∞–Ω–∏–µ CSRF —Ñ–æ—Ä–º (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–∞)
- –ü–µ—Ä–µ—Ö–≤–∞—Ç HTTP —Ç—Ä–∞—Ñ–∏–∫–∞ / MITM –∞—Ç–∞–∫–∏
- –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è / —Ñ–∏—à–∏–Ω–≥
- DoS / DDoS –∞—Ç–∞–∫–∏

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 2: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
–ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å:
- HTTP –≤–º–µ—Å—Ç–æ HTTPS (–Ω–æ—Ä–º–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ HSTS, X-Frame-Options, CSP

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 3: –û–±—â–∏–µ —Ñ—Ä–∞–∑—ã –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏
–ù–ï –ø–∏—Å–∞—Ç—å:
- "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ SQL Injection" (–±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞)
- "–í–æ–∑–º–æ–∂–Ω–∞ XSS –∞—Ç–∞–∫–∞" (–±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞)
- "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å" (–±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏)`

	return fmt.Sprintf(
		`–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–µ–Ω—Ç–µ—Å—Ç–µ—Ä–∞ –Ω–∞ CTF/Bug Bounty.

### –ö–û–ù–¢–ï–ö–°–¢:
URL: %s
Method: %s
Headers (JSON —Ñ–æ—Ä–º–∞—Ç - –º–æ–∂–µ—à—å –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é): %s
Request Body: %s
Response Body: %s
Site Context: %s

–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: %s

%s

### –ó–ê–î–ê–ß–ê:
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç HTTP –æ–±–º–µ–Ω –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –ö–û–ù–ö–†–ï–¢–ù–´–ï –ø—Ä–æ–≤–µ—Ä–∫–∏.

### –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
- –ú–∞–∫—Å–∏–º—É–º 5 –ø—Ä–æ–≤–µ—Ä–æ–∫ (–ª—É—á—à–µ 2-3 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö, —á–µ–º 10 –æ–±—â–∏—Ö)
- –ö–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ = –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞

### –°–ö–û–õ–¨–ö–û –¢–ï–°–¢–û–í –°–û–ó–î–ê–í–ê–¢–¨:
- 1 —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤ (IDOR —Å —á–∏—Å–ª–æ–≤—ã–º ID: –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –¥—Ä—É–≥–æ–µ —á–∏—Å–ª–æ)
- 2-5 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö (MongoDB ID + NoSQLi: —Ä–∞–∑–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã: $ne, $regex, —Ä–∞–∑–Ω—ã–µ ID)
- –ú–æ–¥–µ–ª—å —Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥–∫–∏

- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ –≠–ö–°–ü–õ–£–ê–¢–ò–†–£–ï–ú–û–°–¢–ò, –Ω–µ –ø–æ "–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏"

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ì–ï–ù–ï–†–ê–¶–ò–Ø TEST_REQUESTS (–∫–∞–∫ Burp Repeater):

‚ö†Ô∏è test_requests = –ú–û–î–ò–§–ò–ö–ê–¶–ò–Ø –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –∞ –ù–ï —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å –Ω—É–ª—è!

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. Headers –≤ –ö–û–ù–¢–ï–ö–°–¢–ï —É–∂–µ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ - –º–æ–∂–µ—à—å –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ test_request
2. –í–Ω–µ—Å–∏ –¢–û–õ–¨–ö–û –Ω—É–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON (–∏–∑–º–µ–Ω–∏ Cookie, –¥–æ–±–∞–≤—å payload)
3. –í–µ—Ä–Ω–∏ –ü–û–õ–ù–´–ô headers –æ–±—ä–µ–∫—Ç —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏

**–î–ª—è JWT –∞—Ç–∞–∫:**
- –°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å headers JSON –∏–∑ –ö–û–ù–¢–ï–ö–°–¢–ê
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π –¢–û–õ–¨–ö–û Cookie –ø–æ–ª–µ: –∏–∑–º–µ–Ω–∏ jwt —á–∞—Å—Ç—å, –æ—Å—Ç–∞–≤—å session
- –ù–ï —Ç–µ—Ä—è–π –¥—Ä—É–≥–∏–µ headers (User-Agent, Content-Type, etc)

**–î–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ URL:**
- –°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å URL
- –ò–∑–º–µ–Ω–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: /api/users/123 ‚Üí /api/users/999

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
–ö–û–ù–¢–ï–ö–°–¢ Headers: {"Cookie": "session=abc; jwt=old", "Content-Type": "application/json"}
–¢–≤–æ–π test_request: {"Cookie": "session=abc; jwt=new", "Content-Type": "application/json"}
(—Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –≤—Å—ë, –∏–∑–º–µ–Ω–∏–ª —Ç–æ–ª—å–∫–æ jwt!)

**–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:** 
headers: {"Cookie": "jwt=new"} ‚Üê –ø–æ—Ç–µ—Ä—è–ª–∏ session –∏ Content-Type!

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–û–†–ú–ê–¢ JSON:
–û–¢–í–ï–¢ –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –°–¢–†–û–ì–û –í–ê–õ–ò–î–ù–´–ú JSON –ë–ï–ó –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ì–û –¢–ï–ö–°–¢–ê!

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- Markdown –∫–æ–¥ –±–ª–æ–∫–∏
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ JSON
- Trailing commas –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
- –û–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤–º–µ—Å—Ç–æ –¥–≤–æ–π–Ω—ã—Ö
- –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤ —Å—Ç—Ä–æ–∫–∞—Ö

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è —Å—Ç—Ä–æ–∫
- –≠–∫—Ä–∞–Ω–∏—Ä—É–π —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã: \" –¥–ª—è –∫–∞–≤—ã—á–µ–∫
- –ù–ï –¥–æ–±–∞–≤–ª—è–π –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π - –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ–±–µ–ª—ã
- –ï—Å–ª–∏ –Ω–µ—Ç findings, –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ []
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ JSON –≤–∞–ª–∏–¥–µ–Ω –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
"observation": "Cookie —Å–æ–¥–µ—Ä–∂–∏—Ç JWT —Å claim user:guest"  (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
"headers": {"Cookie": "session=abc; jwt=xyz"}  (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

### –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û - –°–û–ì–õ–ê–°–û–í–ê–ù–ù–û–°–¢–¨ –ü–õ–ê–ù–ê –ò –î–ï–ô–°–¢–í–ò–ô:

‚ö†Ô∏è –ê–õ–ì–û–†–ò–¢–ú –ì–ï–ù–ï–†–ê–¶–ò–ò –ö–ê–ñ–î–û–ì–û FINDING:

**–®–ê–ì 1: –û–ø—Ä–µ–¥–µ–ª–∏ —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—à—å**
- Title: –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞—Ç–∞–∫–∏
- Observation: —á—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –≤–∏–¥–∏—à—å –≤ —Ç—Ä–∞—Ñ–∏–∫–µ (–ø–∞—Ä–∞–º–µ—Ç—Ä, —Ç–æ–∫–µ–Ω, ID)

**–®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è - –ö–ê–ö —Ç—ã —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—à—å?**
–ó–∞–¥–∞–π —Å–µ–±–µ –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å –¥–æ–∫–∞–∂–µ—Ç —ç—Ç—É —É—è–∑–≤–∏–º–æ—Å—Ç—å?"
- –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å –ö–ê–ö –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ‚Üí –ù–ï —Å–æ–∑–¥–∞–≤–∞–π —ç—Ç–æ—Ç finding
- –ï—Å–ª–∏ –∑–Ω–∞–µ—à—å –ö–ê–ö ‚Üí –∑–∞–ø–∏—à–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ URL/body/headers

**–®–ê–ì 3: –°–æ–∑–¥–∞–π test_request —Å –ö–û–ù–ö–†–ï–¢–ù–´–ú –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º**
- Title —É–ø–æ–º–∏–Ω–∞–µ—Ç "$ne" ‚Üí test_request –î–û–õ–ñ–ï–ù —Å–æ–¥–µ—Ä–∂–∞—Ç—å [$ne] –≤ URL –∏–ª–∏ {"$ne":...} –≤ body
- Observation —É–ø–æ–º–∏–Ω–∞–µ—Ç "—á–∏—Å–ª–æ–≤–æ–π ID 123" ‚Üí test_request –î–û–õ–ñ–ï–ù –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π ID (999)
- Title —É–ø–æ–º–∏–Ω–∞–µ—Ç "JWT alg:none" ‚Üí Cookie –î–û–õ–ñ–ï–ù —Å–æ–¥–µ—Ä–∂–∞—Ç—å JWT —Å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–º alg
- Observation —É–ø–æ–º–∏–Ω–∞–µ—Ç "–ø–∞—Ä–∞–º–µ—Ç—Ä order" ‚Üí test_request –î–û–õ–ñ–ï–ù –∏–∑–º–µ–Ω–∏—Ç—å –∏–º–µ–Ω–Ω–æ order

**–®–ê–ì 4: –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**
–ü—Ä–æ—á–∏—Ç–∞–π —Å–≤–æ–π finding —Ü–µ–ª–∏–∫–æ–º –∏ —Å–ø—Ä–æ—Å–∏:
- "–ï—Å—Ç—å –ª–∏ –≤ test_request —Ç–æ, —á—Ç–æ —è —É–ø–æ–º—è–Ω—É–ª –≤ title/observation?"
- "–î–æ–∫–∞–∂–µ—Ç –ª–∏ —ç—Ç–æ—Ç test_request –Ω–∞–ª–∏—á–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏?"
- –ï—Å–ª–∏ –ù–ï–¢ ‚Üí –ü–ï–†–ï–î–ï–õ–ê–ô test_request –∏–ª–∏ –£–î–ê–õ–ò –≤–µ—Å—å finding

–ó–û–õ–û–¢–û–ï –ü–†–ê–í–ò–õ–û: Title + Observation + test_requests –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –û–î–ù–£ –∏—Å—Ç–æ—Ä–∏—é!

### –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê –í JSON:

{
  "summary": "–û–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: —á—Ç–æ —ç—Ç–æ –∑–∞ endpoint –∏ —á—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ",
  "findings": [
    {
      "title": "–ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (NoSQL injection —á–µ—Ä–µ–∑ $ne, –∞ –ù–ï –ø—Ä–æ—Å—Ç–æ NoSQL injection)",
      "observation": "–ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –≤–∏–¥–Ω–æ –≤ —Ç—Ä–∞—Ñ–∏–∫–µ (—É–ø–æ–º—è–Ω–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –µ—Å–ª–∏ –µ—Å—Ç—å)",
      "test_requests": [
        {
          "method": "GET",
          "url": "URL —Å –ö–û–ù–ö–†–ï–¢–ù–´–ú –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º (—Å–æ–¥–µ—Ä–∂–∏—Ç $ne/$regex/–¥—Ä—É–≥–æ–π ID)",
          "headers": {"Cookie": "–ü–û–õ–ù–´–ô Cookie –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞", "Content-Type": "–µ—Å–ª–∏ –Ω—É–∂–µ–Ω"},
          "body": "–ï—Å–ª–∏ POST/PUT –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞—Ç–∞–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä NoSQL –æ–ø–µ—Ä–∞—Ç–æ—Ä)",
          "purpose": "–ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º (–¥–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å title!)"
        }
      ],
      "expected_if_vulnerable": "–ß—Ç–æ —É–≤–∏–¥–∏–º –µ—Å–ª–∏ —É—è–∑–≤–∏–º–æ",
      "expected_if_safe": "–ß—Ç–æ —É–≤–∏–¥–∏–º –µ—Å–ª–∏ –∑–∞—â–∏—â–µ–Ω–æ",
      "effort": "low",
      "impact": "medium"
    }
  ],
  "context_for_later": {
    "identified_patterns": ["–ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è SiteContext"],
    "related_endpoints": ["–°–≤—è–∑–∞–Ω–Ω—ã–µ endpoints –µ—Å–ª–∏ –≤–∏–¥–Ω—ã"],
    "user_role_detected": "guest"
  }
}

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: 
- –ü–æ–ª–µ "purpose" –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è –∫–∞–∂–¥–æ–≥–æ test_request!
- Headers –î–û–õ–ñ–ù–´ –±—ã—Ç—å –ü–û–õ–ù–û–ô –ö–û–ü–ò–ï–ô –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–π —á–∞—Å—Ç–∏
- –ù–ï —Ç–µ—Ä—è–π session cookies, CSRF —Ç–æ–∫–µ–Ω—ã –∏ –¥—Ä—É–≥–∏–µ headers –ø—Ä–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ JWT!
- test_requests –î–û–õ–ñ–ù–´ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å title –∏ observation (–µ—Å–ª–∏ –ø–∏—à–µ—à—å "$ne" - –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ URL/body!)

–í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON –æ–±—ä–µ–∫—Ç–æ–º –≤—ã—à–µ, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ!

### –ü–†–ò–û–†–ò–¢–ò–ó–ê–¶–ò–Ø FINDINGS:

–í–∫–ª—é—á–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å (effort: low, impact: high):
- IDOR —Å —á–∏—Å–ª–æ–≤—ã–º ID (–ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ–Ω—è—Ç—å —á–∏—Å–ª–æ)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (owner_id)
- –î–æ—Å—Ç—É–ø –∫ admin endpoints –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏
- –Ø–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ (stack traces, SQL errors)

–í–∫–ª—é—á–∞—Ç—å –≤–æ –≤—Ç–æ—Ä—É—é –æ—á–µ—Ä–µ–¥—å (effort: medium):
- NoSQL injection (–µ—Å–ª–∏ MongoDB –∏ –≤–∏–¥–Ω—ã $–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã)
- Path traversal (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –ø—É—Ç—ë–º)
- SSRF (–µ—Å–ª–∏ URL –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ)

–ù–ï –≤–∫–ª—é—á–∞—Ç—å (effort: high, –Ω–∏–∑–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å):
- SQLi –±–µ–∑ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—Å—Ç—å input)
- XSS –±–µ–∑ reflection (–ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—Å—Ç—å –ø–æ–ª–µ)
- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏ –∏–∑ blacklist

–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –ê–õ–ì–û–†–ò–¢–ú —Å–æ–∑–¥–∞–Ω–∏—è test_requests:

1Ô∏è‚É£ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é? (–∏–∑ title)
   –ü—Ä–∏–º–µ—Ä: "NoSQL injection —á–µ—Ä–µ–∑ $ne" ‚Üí –∑–Ω–∞—á–∏—Ç test_request –î–û–õ–ñ–ï–ù —Å–æ–¥–µ—Ä–∂–∞—Ç—å $ne –æ–ø–µ—Ä–∞—Ç–æ—Ä
   –ü—Ä–∏–º–µ—Ä: "JWT role manipulation" ‚Üí test_request –¥–æ–ª–∂–µ–Ω –º–µ–Ω—è—Ç—å JWT
   –ü—Ä–∏–º–µ—Ä: "IDOR —á–µ—Ä–µ–∑ user_id" ‚Üí test_request –¥–æ–ª–∂–µ–Ω –º–µ–Ω—è—Ç—å user_id

2Ô∏è‚É£ –ì–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä? (–∏–∑ observation –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
   –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ URL ‚Üí –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π URL
   –ï—Å–ª–∏ JWT –≤ Cookie ‚Üí –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π Cookie —Å –Ω–æ–≤—ã–º JWT
   –ï—Å–ª–∏ POST body ‚Üí –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π body
   
3Ô∏è‚É£ –°–æ—Ö—Ä–∞–Ω–∏ –≤–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç!
   Cookie –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–ø–∏—Ä—É–π –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
   Authorization headers –∫–æ–ø–∏—Ä—É–π
   Content-Type –∫–æ–ø–∏—Ä—É–π –µ—Å–ª–∏ –µ—Å—Ç—å body

4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π:
   ‚ùå –ù–∞–ø–∏—Å–∞–ª "—á–µ—Ä–µ–∑ $ne" –Ω–æ –≤ URL –Ω–µ—Ç $ne? ‚Üí –û–®–ò–ë–ö–ê, –¥–æ–±–∞–≤—å $ne!
   ‚ùå –ù–∞–ø–∏—Å–∞–ª "JWT manipulation" –Ω–æ Cookie —Ç–∞–∫–æ–π –∂–µ? ‚Üí –û–®–ò–ë–ö–ê, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π JWT!
   ‚ùå –ù–∞–ø–∏—Å–∞–ª "IDOR user_id=5" –Ω–æ –≤ URL –æ—Å—Ç–∞–ª—Å—è user_id=5? ‚Üí –û–®–ò–ë–ö–ê, –∏–∑–º–µ–Ω–∏ ID!

–ü–†–ò–ú–ï–†–´ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –ù–ï –∫–æ–ø–∏—Ä—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ payloads):

–ü—Ä–∏–º–µ—Ä 1 - –ü—Ä–æ—Å—Ç–æ–π IDOR:
{
  "summary": "GET /api/orders/{id} - –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–∞",
  "findings": [{
    "title": "IDOR —á–µ—Ä–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–µ order_id",
    "observation": "–ß–∏—Å–ª–æ–≤–æ–π ID=123 –≤ URL –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞",
    "test_requests": [{
      "method": "GET",
      "url": "http://example.com/api/orders/999",
      "headers": {},
      "purpose": "–î–æ—Å—Ç—É–ø –∫ —á—É–∂–æ–º—É –∑–∞–∫–∞–∑—É (999‚â†123)"
    }],
    "expected_if_vulnerable": "200 OK —Å —á—É–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏",
    "expected_if_safe": "403/404",
    "effort": "low",
    "impact": "high"
  }]
}

–ü—Ä–∏–º–µ—Ä 2 - –õ—é–±–∞—è –¥—Ä—É–≥–∞—è –∞—Ç–∞–∫–∞ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ):
{
  "summary": "–û–ø–∏—Å–∞–Ω–∏–µ endpoint",
  "findings": [{
    "title": "[–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –º–µ—Ö–∞–Ω–∏–∑–º–∞/–ø–∞—Ä–∞–º–µ—Ç—Ä–∞]",
    "observation": "[–ß—Ç–æ –≤–∏–¥–Ω–æ: —É–ø–æ–º—è–Ω–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä/—Ç–æ–∫–µ–Ω/ID]",
    "test_requests": [{
      "method": "GET/POST",
      "url": "[URL —Å –ö–û–ù–ö–†–ï–¢–ù–´–ú –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∏–∑ title]",
      "headers": {"Cookie": "[–ü–û–õ–ù–ê–Ø –∫–æ–ø–∏—è –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏]"},
      "body": "[–ï—Å–ª–∏ POST - payload —Å –∞—Ç–∞–∫–æ–π –∏–∑ title]",
      "purpose": "[–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –∏–∑ title]"
    }],
    "expected_if_vulnerable": "–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏",
    "expected_if_safe": "–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∑–∞—â–∏—Ç–µ",
    "effort": "low/medium/high",
    "impact": "low/medium/high/critical"
  }],
  "context_for_later": {
    "identified_patterns": ["–ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"],
    "related_endpoints": ["/api/*"],
    "user_role_detected": "guest/user/admin"
  }
}

–ü–ï–†–ï–î –û–¢–ü–†–ê–í–ö–û–ô: –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–≤–æ–π JSON –≤–∞–ª–∏–¥–µ–Ω:
- –ù–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏–π
- –í—Å–µ –∫–∞–≤—ã—á–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
- –ù–µ—Ç trailing commas
- –ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

–û–¢–í–ï–¢ –°–¢–†–û–ì–û –í JSON –§–û–†–ú–ê–¢–ï –ë–ï–ó MARKDOWN –ë–õ–û–ö–û–í –ò –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ì–û –¢–ï–ö–°–¢–ê!
`,
		req.URL,
		req.Method,
		formatHeaders(req.Headers),
		SanitizeForPrompt(TruncateString(req.RequestBody, 500)),
		SanitizeForPrompt(TruncateString(req.ResponseBody, 1000)),
		req.SiteContext.Host,
		string(extractedDataJson),
		blacklist,
	)
}

// TruncateString –æ–±—Ä–µ–∑–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã
func TruncateString(s string, maxLen int) string {
	if len(s) <= maxLen {
		return s
	}
	return s[:maxLen] + "..."
}

// SanitizeForPrompt –æ—á–∏—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –≤ LLM –ø—Ä–æ–º–ø—Ç
// –ó–∞–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å JSON parsing errors
func SanitizeForPrompt(s string) string {
	// –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –≤–∏–¥—ã –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã
	s = strings.ReplaceAll(s, "\r\n", " ")
	s = strings.ReplaceAll(s, "\n", " ")
	s = strings.ReplaceAll(s, "\r", " ")
	// –°—Ö–ª–æ–ø—ã–≤–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
	s = strings.Join(strings.Fields(s), " ")
	return s
}

// BuildURLAnalysisPrompt —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ü–µ–Ω–∫–∏ URL
// –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –Ω—É–∂–µ–Ω –ª–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–ª–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å?
func BuildURLAnalysisPrompt(req *models.URLAnalysisRequest) string {
	techStackInfo := "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω"
	if req.SiteContext != nil && req.SiteContext.TechStack != nil && len(req.SiteContext.TechStack.Technologies) > 0 {
		techs := make([]string, 0, len(req.SiteContext.TechStack.Technologies))
		for _, tech := range req.SiteContext.TechStack.Technologies {
			techs = append(techs, tech.Name)
		}
		// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 5 —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏
		if len(techs) > 5 {
			techs = techs[:5]
		}
		techStackInfo = strings.Join(techs, ", ")
	}

	responsePreview := TruncateString(req.ResponseBody, 300)

	blacklist := `## –ß–¢–û –ù–ï –£–ü–û–ú–ò–ù–ê–¢–¨ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–ì–ù–û–†–ò–†–û–í–ê–¢–¨)

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 1: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏ (–Ω–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
–ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å:
- –ë—Ä—É—Ç—Ñ–æ—Ä—Å –ø–∞—Ä–æ–ª–µ–π / credential stuffing / password spraying
- –°–æ–∑–¥–∞–Ω–∏–µ CSRF —Ñ–æ—Ä–º (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–∞, –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞)
- –ü–µ—Ä–µ—Ö–≤–∞—Ç HTTP —Ç—Ä–∞—Ñ–∏–∫–∞ / MITM –∞—Ç–∞–∫–∏
- –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è / —Ñ–∏—à–∏–Ω–≥
- DoS / DDoS –∞—Ç–∞–∫–∏
- Timing attacks –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 2: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–≤–Ω–µ scope –∞–Ω–∞–ª–∏–∑–∞)
–ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å:
- HTTP –≤–º–µ—Å—Ç–æ HTTPS (–Ω–æ—Ä–º–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ HSTS, X-Frame-Options, CSP (–µ—Å–ª–∏ –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∞—Ç–∞–∫–∏)
- "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å..." ‚Äî —ç—Ç–æ –Ω–µ –¥–ª—è CTF

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 3: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã (–Ω–µ –ø—Ä–æ–±–ª–µ–º—ã)
–ù–ï —É–ø–æ–º–∏–Ω–∞—Ç—å –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º—ã:
- "CSRF —Ç–æ–∫–µ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç" ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–∞, –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ
- "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è" ‚Äî –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- "Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç" ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–∞

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 4: –û–±—â–∏–µ —Ñ—Ä–∞–∑—ã –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏
–ù–ï –ø–∏—Å–∞—Ç—å:
- "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ SQL Injection" (–±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞)
- "–í–æ–∑–º–æ–∂–Ω–∞ XSS –∞—Ç–∞–∫–∞" (–±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞)
- "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å" (–±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏)`

	return fmt.Sprintf(
		`–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –ø–æ–º–æ–≥–∞—é—â–∏–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

### –í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:
%s %s
Content-Type: %s
Response preview: %s
–¢–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–∞–π—Ç–∞: %s

%s

### –ó–ê–î–ê–ß–ê:
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π HTTP –∑–∞–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç –∏ –æ–ø–∏—à–∏ –ß–¢–û –¢–´ –í–ò–î–ò–®–¨.
–ù–ï –¥–µ–ª–∞–π –≤—ã–≤–æ–¥–æ–≤ –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç—ã –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–û–†–ú–ê–¢ JSON:
–û–¢–í–ï–¢ –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –°–¢–†–û–ì–û –í–ê–õ–ò–î–ù–´–ú JSON –ë–ï–ó –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ì–û –¢–ï–ö–°–¢–ê!
- –ù–ï –¥–æ–±–∞–≤–ª—è–π markdown –∫–æ–¥ –±–ª–æ–∫–∏
- –ù–ï –¥–æ–±–∞–≤–ª—è–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ JSON
- –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è —Å—Ç—Ä–æ–∫
- –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
- boolean –∑–Ω–∞—á–µ–Ω–∏—è: true –∏–ª–∏ false –±–µ–∑ –∫–∞–≤—ã—á–µ–∫
- numbers: 0.5 –±–µ–∑ –∫–∞–≤—ã—á–µ–∫

### –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê –í JSON:

{
  "interest_level": "high",
  "endpoint_type": "auth",
  "observations": [
    "–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ 1 (—Ñ–∞–∫—Ç, –Ω–µ –≤—ã–≤–æ–¥)",
    "–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ 2"
  ],
  "suggested_checks": [
    {
      "what": "–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ)",
      "how": "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å)",
      "why": "–ü–æ—á–µ–º—É —ç—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ"
    }
  ],
  "detected_tech": {
    "database": "PostgreSQL",
    "backend": "Express",
    "evidence": "–ü–æ—á–µ–º—É —Ç–∞–∫ —Ä–µ—à–∏–ª"
  },
  "tags": ["auth", "user-data"],
  "url_note": {
    "content": "–ó–∞–º–µ—Ç–∫–∞ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ endpoint'–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —É—Ä–æ–≤–Ω–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏",
    "suspicious": true,
    "vuln_hint": "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è high/medium)",
    "confidence": 0.8
  }
}

–í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON –æ–±—ä–µ–∫—Ç–æ–º –≤—ã—à–µ, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ!

### –ü–†–ê–í–ò–õ–ê INTEREST LEVEL:

HIGH ‚Äî –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ:
- Admin –ø–∞–Ω–µ–ª–∏, –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- Endpoints —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (PII)
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏ (upload, download, path –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö)
- –ß–∏—Å–ª–æ–≤–æ–π ID –≤ URL + –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç–≤–µ—Ç–µ (IDOR –∫–∞–Ω–¥–∏–¥–∞—Ç)
- –í–∏–¥–∏–º—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

MEDIUM ‚Äî –°—Ç–æ–∏—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å:
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- API endpoints –±–µ–∑ —è–≤–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø—Ä–æ–±–ª–µ–º

LOW ‚Äî –ú–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å:
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã
- Health checks, metrics
- –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±–µ–∑ sensitive data

### –ü–†–ê–í–ò–õ–ê –ì–ï–ù–ï–†–ê–¶–ò–ò –ó–ê–ú–ï–¢–û–ö (url_note):

**–î–ª—è HIGH interest** (–ø–æ–¥—Ä–æ–±–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞):
- –û–ø–∏—à–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- –£–∫–∞–∂–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
- –ü—Ä–∏–º–µ—Ä: "–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏. –û–±–Ω–∞—Ä—É–∂–µ–Ω PostgreSQL, Express framework. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å Broken Access Control."

**–î–ª—è MEDIUM interest** (–∫–æ—Ä–æ—Ç–∫–∞—è –∑–∞–º–µ—Ç–∫–∞):
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ endpoint'–∞ –≤ 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏
- –ü—Ä–∏–º–µ—Ä: "API endpoint –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"

**–î–ª—è LOW interest** (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞):
- –¢–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–∞–º—ã—Ö –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞—Ö
- –ü—Ä–∏–º–µ—Ä: "–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—É—Ä—Å - CSS —Ñ–∞–π–ª"

### –ü–†–ò–ú–ï–†–´:

–ü—Ä–∏–º–µ—Ä 1 - IDOR:
{
  "interest_level": "high",
  "endpoint_type": "crud",
  "observations": [
    "GET /api/orders/42 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞",
    "–ß–∏—Å–ª–æ–≤–æ–π ID –≤ URL",
    "–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç email –∑–∞–∫–∞–∑—á–∏–∫–∞ –∏ —Å—É–º–º—É –ø–ª–∞—Ç–µ–∂–∞"
  ],
  "suggested_checks": [
    {
      "what": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–æ–º—É –∑–∞–∫–∞–∑—É",
      "how": "–ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è –∫–∞–∫ –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –∑–∞–ø—Ä–æ—Å–∏ /api/orders/42",
      "why": "–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–∞–∫–∞–∑–∞, –≤–æ–∑–º–æ–∂–µ–Ω IDOR"
    }
  ],
  "detected_tech": {
    "database": "MySQL",
    "backend": "unknown",
    "evidence": "–ß–∏—Å–ª–æ–≤—ã–µ ID —Ç–∏–ø–∏—á–Ω—ã –¥–ª—è MySQL"
  },
  "tags": ["user-data", "financial", "idor-candidate"],
  "url_note": {
    "content": "–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–∞ –ø–æ ID —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º IDOR. –û–±–Ω–∞—Ä—É–∂–µ–Ω MySQL, –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.",
    "suspicious": true,
    "vuln_hint": "IDOR - –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º –∑–∞–∫–∞–∑–∞–º —á–µ—Ä–µ–∑ –ø–æ–¥–º–µ–Ω—É ID",
    "confidence": 0.9
  }
}`,
		req.Method,
		req.URL,
		req.ContentType,
		responsePreview,
		techStackInfo,
		blacklist,
	)
}

// BuildHypothesisPrompt —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–∏–ø–æ—Ç–µ–∑ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
func BuildHypothesisPrompt(req *models.HypothesisRequest) string {
	// === –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢ ===

	// 1. –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
	appOverview := buildAppOverview(req.SiteContext)

	// 2. URL –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å –∞–Ω–∞–ª–∏–∑–æ–º
	urlPatternsAnalysis := buildURLPatternsAnalysis(req.SiteContext)

	// 3. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ —Å —É—è–∑–≤–∏–º–æ—Å—Ç—è–º–∏
	techStackInfo := buildTechStackInfo(req.SiteContext, req.TechVulnerabilities)

	// 4. –§–æ—Ä–º—ã –∏ CSRF –∑–∞—â–∏—Ç–∞
	formsAnalysis := buildFormsAnalysis(req.SiteContext)

	// 5. CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã
	crudAnalysis := buildCRUDAnalysis(req.SiteContext)

	// 6. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤
	temporalAnalysis := buildTemporalAnalysis(req.SiteContext)

	// 7. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
	var verificationJson string
	if req.VerificationResults != nil {
		verificationJson = formatJSON(req.VerificationResults)
	} else {
		verificationJson = "–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –µ—â–µ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å"
	}

	// 8. –ö—Ä–æ—Å—Å-—ç–Ω–¥–ø–æ–∏–Ω—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û)
	var crossEndpointJson string
	if len(req.CrossEndpointPatterns) > 0 {
		crossEndpointJson = formatJSON(req.CrossEndpointPatterns)
	} else {
		crossEndpointJson = "–ö—Ä–æ—Å—Å-—ç–Ω–¥–ø–æ–∏–Ω—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
	}

	// 9. –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
	suspiciousGrouped := groupPatternsByAttackType(req.SuspiciousPatterns)

	return fmt.Sprintf(
		`–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –ø–µ–Ω—Ç–µ—Å—Ç–µ—Ä, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Bug Bounty/CTF.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –Ω–∞ –æ—Å–Ω–æ–≤–µ –ü–û–õ–ù–û–ì–û –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–æ–∑–¥–∞—Ç—å –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ô –ü–õ–ê–ù –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø.

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    1. –û–ë–ó–û–† –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø                                 ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    2. –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö                             ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    3. URL –ü–ê–¢–¢–ï–†–ù–´ –ò ENDPOINTS                         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    4. –§–û–†–ú–´ –ò CSRF –ó–ê–©–ò–¢–ê                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    5. CRUD –û–ü–ï–†–ê–¶–ò–ò                                    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    6. –í–†–ï–ú–ï–ù–ù–´–ï –ü–ê–¢–¢–ï–†–ù–´                               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë             7. –ü–û–î–û–ó–†–ò–¢–ï–õ–¨–ù–´–ï –ü–ê–¢–¢–ï–†–ù–´ (–ì–†–£–ü–ü–ò–†–û–í–ö–ê)                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë             8. –†–ï–ó–£–õ–¨–¢–ê–¢–´ –í–ï–†–ò–§–ò–ö–ê–¶–ò–ò (–§–ê–ö–¢–´!)                         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         9. –ö–†–û–°–°-–≠–ù–î–ü–û–ò–ù–¢ –ü–ê–¢–¢–ï–†–ù–´ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
%s

### –¢–í–û–Ø –ó–ê–î–ê–ß–ê - –°–¢–†–ê–¢–ï–ì–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó:

1. **–°–ò–ù–¢–ï–ó –ò–ù–§–û–†–ú–ê–¶–ò–ò**
   –û–±—ä–µ–¥–∏–Ω–∏ –í–°–Æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ 9 —Å–µ–∫—Ü–∏–π –≤—ã—à–µ:
   - –ö–∞–∫–æ–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è?
   - –ö–∞–∫–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞—â–∏—â–µ–Ω—ã —Å–ª–∞–±–æ?
   - –ï—Å—Ç—å –ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∫—Ä–æ—Å—Å-—ç–Ω–¥–ø–æ–∏–Ω—Ç)?
   - –ß—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, —á—Ç–æ ‚Äî —Ç–µ–æ—Ä–∏—è?
   - **–í–ê–ñ–ù–û –¥–ª—è auth_mechanism**: –ü–æ—Å–º–æ—Ç—Ä–∏ –≤ "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã" –∏ "URL –ø–∞—Ç—Ç–µ—Ä–Ω—ã" –Ω–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è Authorization, Bearer, JWT, Cookie, session - —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞!

2. **–ü–†–ò–û–†–ò–¢–ò–ó–ê–¶–ò–Ø –ê–¢–ê–ö**
   –†–∞–Ω–∂–∏—Ä—É–π –Ω–∞—Ö–æ–¥–∫–∏ –ø–æ —Ä–µ–∞–ª—å–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏:
   - RECOMMEND: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ + –∫—Ä–æ—Å—Å-—ç–Ω–¥–ø–æ–∏–Ω—Ç
   - CONSIDER: –°–∏–ª—å–Ω—ã–µ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è —Å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏
   - OPTIONAL: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫

3. **–ö–û–ù–¢–ï–ö–°–¢ –ò –°–í–Ø–ó–ò**
   –ò—â–∏ –°–í–Ø–ó–ò –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º–∏:
   - –§–æ—Ä–º—ã –±–µ–∑ CSRF + –∞–¥–º–∏–Ω—Å–∫–∏–µ endpoints = Broken Access Control
   - CRUD –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ + —á–∏—Å–ª–æ–≤—ã–µ ID = IDOR –Ω–∞ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö
   - –û–¥–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö + –º–Ω–æ–≥–æ endpoints = —Å–∏—Å—Ç–µ–º–Ω–∞—è SQL injection

4. **–ö–û–ù–ö–†–ï–¢–ù–´–ï –®–ê–ì–ò**
   –ö–∞–∂–¥–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è = –ö–û–ù–ö–†–ï–¢–ù–´–ï —à–∞–≥–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–µ —Ç–µ–æ—Ä–∏—è

### –ü–†–ê–í–ò–õ–ê PRIORITY (–°–¢–†–û–ì–ò–ï):

üî¥ **RECOMMEND** ‚Äî –¢–û–õ–¨–ö–û –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ:
   ‚úì –ö—Ä–æ—Å—Å-—ç–Ω–¥–ø–æ–∏–Ω—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã (3+ endpoints)
   ‚úì VerificationResults: Confidence > 0.85
   ‚úì –§–æ—Ä–º—ã –±–µ–∑ CSRF + –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   ‚úì –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ endpoints –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

üü° **CONSIDER** ‚Äî –°–∏–ª—å–Ω—ã–µ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è:
   ‚úì VerificationResults: Confidence 0.70-0.85
   ‚úì Endpoints —Å –ø–æ—Ö–æ–∂–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
   ‚úì –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã –±–µ–∑ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

‚ö™ **OPTIONAL** ‚Äî –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –ª—É—á—à–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
   ‚úì –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤
   ‚úì VerificationResults: ConfirmedSafe > 0
   ‚úì Endpoints –±–µ–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø—Ä–æ–±–ª–µ–º

### –ö–†–û–°–°-ENDPOINT –ê–ù–ê–õ–ò–ó (–ö–†–ò–¢–ò–ß–ù–û):

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –û–î–ò–ù –ø–∞—Ç—Ç–µ—Ä–Ω –Ω–∞ –ù–ï–°–ö–û–õ–¨–ö–ò–• endpoints ‚Äî —ç—Ç–æ –°–ò–°–¢–ï–ú–ù–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞:

–ü—Ä–∏–º–µ—Ä 1: –°–∏—Å—Ç–µ–º–Ω–∞—è IDOR
- /api/users/{id} - ID –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º
- /api/orders/{id} - ID –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º  
- /api/invoices/{id} - ID –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º
= –°–∏—Å—Ç–µ–º–Ω–∞—è IDOR: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

–ü—Ä–∏–º–µ—Ä 2: –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ö–æ–¥
- /api/v1/admin/users - —Ç—Ä–µ–±—É–µ—Ç auth
- /api/v2/admin/users - –ë–ï–ó auth
= Broken Access Control –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ API

–ü—Ä–∏–º–µ—Ä 3: NoSQL Injection –ø–æ –≤—Å–µ–π –ë–î
- /api/search?name= - MongoDB
- /api/filter?type= - MongoDB
- /api/query?id= - MongoDB
= NoSQL Injection –Ω–∞ –≤—Å–µ—Ö search endpoints

### –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê –í JSON:

{
  "investigation_suggestions": [
    {
      "title": "–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–º–∞–∫—Å 10 —Å–ª–æ–≤)",
      "reasoning": "–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ü–û–ß–ï–ú–£ —ç—Ç–æ –≤–∞–∂–Ω–æ. –£–ø–æ–º—è–Ω–∏: 1) –ß—Ç–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ (—Ñ–∞–∫—Ç—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞), 2) –ü–æ—á–µ–º—É —ç—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç—å (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ), 3) –ú–∞—Å—à—Ç–∞–± –ø—Ä–æ–±–ª–µ–º—ã (—Å–∫–æ–ª—å–∫–æ endpoints, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)",
      "affected_endpoints": [
        "/api/users/{id}",
        "/api/orders/{id}",
        "/api/profiles/{id}"
      ],
      "what_to_check": [
        "–®–∞–≥ 1: –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–∏–º–µ—Ä–æ–º –∑–∞–ø—Ä–æ—Å–∞",
        "–®–∞–≥ 2: –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –æ—Ç–≤–µ—Ç–µ",
        "–®–∞–≥ 3: –ö–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç—å"
      ],
      "priority": "recommend",
      "cross_endpoint_pattern": "–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞"
    }
  ],
  
  "site_understanding": {
    "likely_architecture": "SPA + REST API / Monolith / Microservices / Serverless",
    "auth_mechanism": "JWT tokens / Session cookies / API Keys / OAuth / None detected (–ê–ù–ê–õ–ò–ó–ò–†–£–ô –ó–ê–ì–û–õ–û–í–ö–ò: Authorization Bearer, Cookie, X-Api-Key)",
    "data_sensitivity": "–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö: PII, —Ñ–∏–Ω–∞–Ω—Å—ã, credentials, internal data",
    "attack_surface_summary": "2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: –≥–ª–∞–≤–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫ –∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å",
    "key_technologies": ["Express.js", "PostgreSQL", "React"],
    "security_posture": "–û—Ü–µ–Ω–∫–∞ –∑–∞—â–∏—â–µ–Ω–Ω–æ—Å—Ç–∏: —Å–ª–∞–±–∞—è/—Å—Ä–µ–¥–Ω—è—è/—Å–∏–ª—å–Ω–∞—è —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º"
  }
}

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–û–†–ú–ê–¢ JSON:
–û–¢–í–ï–¢ –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –°–¢–†–û–ì–û –í–ê–õ–ò–î–ù–´–ú JSON –ë–ï–ó –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ì–û –¢–ï–ö–°–¢–ê!

**–ó–∞–ø—Ä–µ—â–µ–Ω–æ:**
- Markdown –∫–æ–¥ –±–ª–æ–∫–∏
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ JSON
- Trailing commas –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
- –û–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤–º–µ—Å—Ç–æ –¥–≤–æ–π–Ω—ã—Ö
- –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤ —Å—Ç—Ä–æ–∫–∞—Ö

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è —Å—Ç—Ä–æ–∫
- –ù–ï –¥–æ–±–∞–≤–ª—è–π –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π - –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ–±–µ–ª—ã
- –≠–∫—Ä–∞–Ω–∏—Ä—É–π —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã: \" –¥–ª—è –∫–∞–≤—ã—á–µ–∫
- cross_endpoint_pattern: –ü–£–°–¢–ê–Ø –°–¢–†–û–ö–ê "" –µ—Å–ª–∏ –Ω–µ—Ç (–ù–ï null, –ù–ï undefined)
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ JSON –≤–∞–ª–∏–¥–µ–Ω –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### –ü–†–ò–ú–ï–†–´ –ö–ê–ß–ï–°–¢–í–ï–ù–ù–´–• –ì–ò–ü–û–¢–ï–ó:

–ü—Ä–∏–º–µ—Ä 1 - –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è IDOR –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö endpoints:
{
  "investigation_suggestions": [
    {
      "title": "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–∞—è IDOR —É—è–∑–≤–∏–º–æ—Å—Ç—å –Ω–∞ –í–°–ï–• endpoints",
      "reasoning": "–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–∫–∞–∑–∞–ª–∞: ConfirmedVulnerable=5 –∏–∑ 5 endpoints. CrossEndpointPattern —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—É—é IDOR –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ /resource/{id}. –≠—Ç–æ –Ω–µ —Ç–µ–æ—Ä–∏—è, —ç—Ç–æ —Ñ–∞–∫—Ç.",
      "affected_endpoints": ["/api/users/{id}", "/api/orders/{id}", "/api/invoices/{id}", "/api/profiles/{id}", "/api/products/{id}"],
      "what_to_check": [
        "–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö endpoints —Å —á–∏—Å–ª–æ–≤—ã–º–∏ ID",
        "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –≤ –∫–æ–¥–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞",
        "–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞—Å—à—Ç–∞–±: —Å–∫–æ–ª—å–∫–æ endpoints –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ"
      ],
      "priority": "recommend",
      "cross_endpoint_pattern": "IDOR —Å —á–∏—Å–ª–æ–≤—ã–º–∏ ID –Ω–∞ 5+ endpoints"
    }
  ],
  "site_understanding": {
    "likely_architecture": "SPA+REST API (Node.js/Express)",
    "auth_mechanism": "JWT —Ç–æ–∫–µ–Ω—ã –≤ Authorization: Bearer header (–≤–∏–¥–Ω–æ –≤ —Ç—Ä–∞—Ñ–∏–∫–µ)",
    "data_sensitivity": "Email, phone, orders, financial data - –í–°–ï –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ IDOR",
    "attack_surface_summary": "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è IDOR —É—è–∑–≤–∏–º–æ—Å—Ç—å –Ω–∞ –≤—Å–µ–π API. –ù–µ–æ–±—Ö–æ–¥–∏–º –ø–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–∞."
  }
}

–ü—Ä–∏–º–µ—Ä 2 - Session Cookies:
{
  "investigation_suggestions": [...],
  "site_understanding": {
    "likely_architecture": "–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π MPA (Multi-Page Application)",
    "auth_mechanism": "Server-side sessions —á–µ—Ä–µ–∑ Cookie (PHPSESSID/connect.sid –≤–∏–¥–Ω—ã –≤ —Ç—Ä–∞—Ñ–∏–∫–µ)",
    "data_sensitivity": "User data, payment info",
    "attack_surface_summary": "CSRF —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–æ–≤."
  }
}

–ü–ï–†–ï–î –û–¢–ü–†–ê–í–ö–û–ô: –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–≤–æ–π JSON –≤–∞–ª–∏–¥–µ–Ω:
- –ù–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏–π
- –í—Å–µ –∫–∞–≤—ã—á–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
- –ù–µ—Ç trailing commas
- –ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

–û–¢–í–ï–¢ –°–¢–†–û–ì–û –í JSON –§–û–†–ú–ê–¢–ï –ë–ï–ó MARKDOWN –ë–õ–û–ö–û–í –ò –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ì–û –¢–ï–ö–°–¢–ê!
`,
		appOverview,
		techStackInfo,
		urlPatternsAnalysis,
		formsAnalysis,
		crudAnalysis,
		temporalAnalysis,
		suspiciousGrouped,
		verificationJson,
		crossEndpointJson,
	)
}

// === HELPER FUNCTIONS FOR STRUCTURED CONTEXT ===

// buildAppOverview —Å–æ–∑–¥–∞–µ—Ç –æ–±–∑–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
func buildAppOverview(ctx *models.SiteContext) string {
	var overview strings.Builder

	overview.WriteString(fmt.Sprintf("Host: %s\n", ctx.Host))
	overview.WriteString(fmt.Sprintf("–°–æ–±—Ä–∞–Ω–æ URL –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤: %d\n", len(ctx.URLPatterns)))
	overview.WriteString(fmt.Sprintf("–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ä–º: %d\n", len(ctx.Forms)))
	overview.WriteString(fmt.Sprintf("CRUD —Ä–µ—Å—É—Ä—Å–æ–≤: %d\n", len(ctx.ResourceCRUD)))
	overview.WriteString(fmt.Sprintf("–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: %d\n", ctx.RequestCount))
	overview.WriteString(fmt.Sprintf("–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤: %d\n", len(ctx.VerifiedPatterns)))

	return overview.String()
}

// buildTechStackInfo —Å–æ–∑–¥–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
func buildTechStackInfo(ctx *models.SiteContext, techVulns []string) string {
	var info strings.Builder

	if ctx.TechStack == nil || len(ctx.TechStack.Technologies) == 0 {
		return "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã"
	}

	for _, tech := range ctx.TechStack.Technologies {
		info.WriteString(fmt.Sprintf("‚Ä¢ %s (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: %.0f%%)\n", tech.Name, tech.Confidence*100))
		info.WriteString(fmt.Sprintf("  –ü—Ä–∏—á–∏–Ω–∞: %s\n", tech.Reason))
	}

	if len(techVulns) > 0 {
		info.WriteString("\n–ò–∑–≤–µ—Å—Ç–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:\n")
		for _, vuln := range techVulns {
			info.WriteString(fmt.Sprintf("  - %s\n", vuln))
		}
	}

	return info.String()
}

// buildURLPatternsAnalysis —Å–æ–∑–¥–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ URL –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
func buildURLPatternsAnalysis(ctx *models.SiteContext) string {
	if len(ctx.URLPatterns) == 0 {
		return "URL –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
	}

	var analysis strings.Builder

	// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø–∞–º
	authPatterns := make([]string, 0)
	apiPatterns := make([]string, 0)
	adminPatterns := make([]string, 0)
	idorCandidates := make([]string, 0)
	otherPatterns := make([]string, 0)

	for _, pattern := range ctx.URLPatterns {
		patternStr := pattern.Pattern
		var note string
		if len(pattern.Notes) > 0 {
			lastNote := pattern.Notes[len(pattern.Notes)-1]
			note = fmt.Sprintf(" [%s, conf=%.2f]", lastNote.Content, lastNote.Confidence)
			if lastNote.Suspicious {
				note += " ‚ö†Ô∏è"
			}
		}

		fullStr := patternStr + note

		// –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
		patternLower := strings.ToLower(patternStr)
		if strings.Contains(patternLower, "auth") || strings.Contains(patternLower, "login") {
			authPatterns = append(authPatterns, fullStr)
		} else if strings.Contains(patternLower, "admin") {
			adminPatterns = append(adminPatterns, fullStr)
		} else if strings.Contains(patternLower, "/api/") {
			apiPatterns = append(apiPatterns, fullStr)
		} else if strings.Contains(patternStr, "{id}") || strings.Contains(patternStr, "{uuid}") {
			idorCandidates = append(idorCandidates, fullStr)
		} else {
			otherPatterns = append(otherPatterns, fullStr)
		}
	}

	if len(authPatterns) > 0 {
		analysis.WriteString("üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:\n")
		for _, p := range authPatterns {
			analysis.WriteString(fmt.Sprintf("  ‚Ä¢ %s\n", p))
		}
	}

	if len(adminPatterns) > 0 {
		analysis.WriteString("\nüëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ:\n")
		for _, p := range adminPatterns {
			analysis.WriteString(fmt.Sprintf("  ‚Ä¢ %s\n", p))
		}
	}

	if len(apiPatterns) > 0 {
		analysis.WriteString("\nüîå API Endpoints:\n")
		for _, p := range apiPatterns {
			analysis.WriteString(fmt.Sprintf("  ‚Ä¢ %s\n", p))
		}
	}

	if len(idorCandidates) > 0 {
		analysis.WriteString("\nüéØ –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–∞ IDOR:\n")
		for _, p := range idorCandidates {
			analysis.WriteString(fmt.Sprintf("  ‚Ä¢ %s\n", p))
		}
	}

	if len(otherPatterns) > 0 && len(otherPatterns) <= 10 {
		analysis.WriteString("\nüìù –ü—Ä–æ—á–∏–µ:\n")
		for _, p := range otherPatterns {
			analysis.WriteString(fmt.Sprintf("  ‚Ä¢ %s\n", p))
		}
	}

	return analysis.String()
}

// buildFormsAnalysis —Å–æ–∑–¥–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º
func buildFormsAnalysis(ctx *models.SiteContext) string {
	if len(ctx.Forms) == 0 {
		return "–§–æ—Ä–º –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
	}

	var analysis strings.Builder

	formsWithCSRF := 0
	formsWithoutCSRF := 0
	sensitiveForms := 0

	for _, form := range ctx.Forms {
		if form.HasCSRFToken {
			formsWithCSRF++
		} else {
			formsWithoutCSRF++
		}

		// –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
		for _, field := range form.Fields {
			if field.Sensitive {
				sensitiveForms++
				break
			}
		}

		// –î–µ—Ç–∞–ª–∏ —Ñ–æ—Ä–º—ã
		csrfStatus := "‚ùå –ë–ï–ó CSRF"
		if form.HasCSRFToken {
			csrfStatus = "‚úÖ –° CSRF"
		}

		analysis.WriteString(fmt.Sprintf("‚Ä¢ %s %s %s (–ø–æ–ª–µ–π: %d)\n",
			form.Method, form.Action, csrfStatus, len(form.Fields)))
	}

	analysis.WriteString(fmt.Sprintf("\n–ò—Ç–æ–≥–æ: %d —Ñ–æ—Ä–º, %d —Å CSRF, %d –ë–ï–ó CSRF, %d —Å sensitive –ø–æ–ª—è–º–∏\n",
		len(ctx.Forms), formsWithCSRF, formsWithoutCSRF, sensitiveForms))

	if formsWithoutCSRF > 0 {
		analysis.WriteString("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ñ–æ—Ä–º—ã –±–µ–∑ CSRF –∑–∞—â–∏—Ç—ã!\n")
	}

	return analysis.String()
}

// buildCRUDAnalysis —Å–æ–∑–¥–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
func buildCRUDAnalysis(ctx *models.SiteContext) string {
	if len(ctx.ResourceCRUD) == 0 {
		return "CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
	}

	var analysis strings.Builder

	for resource, mapping := range ctx.ResourceCRUD {
		analysis.WriteString(fmt.Sprintf("–†–µ—Å—É—Ä—Å: %s\n", resource))

		if len(mapping.Operations) > 0 {
			for op, endpoints := range mapping.Operations {
				analysis.WriteString(fmt.Sprintf("  %s: %v\n", op, endpoints))
			}
		}

		analysis.WriteString("\n")
	}

	return analysis.String()
}

// buildTemporalAnalysis —Å–æ–∑–¥–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
func buildTemporalAnalysis(ctx *models.SiteContext) string {
	if len(ctx.RecentRequests) == 0 {
		return "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞"
	}

	var analysis strings.Builder

	// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø—Ä–æ—Å–æ–≤
	recentCount := len(ctx.RecentRequests)
	if recentCount > 10 {
		recentCount = 10
	}

	analysis.WriteString(fmt.Sprintf("–ü–æ—Å–ª–µ–¥–Ω–∏–µ %d –∑–∞–ø—Ä–æ—Å–æ–≤:\n", recentCount))

	for i := len(ctx.RecentRequests) - recentCount; i < len(ctx.RecentRequests); i++ {
		req := ctx.RecentRequests[i]
		analysis.WriteString(fmt.Sprintf("  %s %s (status: %d, duration: %dms)\n",
			req.Method, req.Path, req.StatusCode, req.Duration))
	}

	return analysis.String()
}

// filterHighQualityPatterns —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å –≤—ã—Å–æ–∫–∏–º confidence
func filterHighQualityPatterns(patterns []*models.URLPattern) []*models.URLPattern {
	filtered := make([]*models.URLPattern, 0)
	for _, pattern := range patterns {
		// –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–º–µ—Ç–∫—É –∏–∑ –º–∞—Å—Å–∏–≤–∞
		if len(pattern.Notes) > 0 {
			lastNote := pattern.Notes[len(pattern.Notes)-1]
			if lastNote.Confidence >= 0.7 {
				filtered = append(filtered, pattern)
			}
		}
	}
	return filtered
}

// groupPatternsByAttackType –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ–º—É —Ç–∏–ø—É –∞—Ç–∞–∫–∏
func groupPatternsByAttackType(patterns []*models.URLPattern) string {
	idorPatterns := make([]string, 0)
	sqlPatterns := make([]string, 0)
	authPatterns := make([]string, 0)
	otherPatterns := make([]string, 0)

	for _, p := range patterns {
		// –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–º–µ—Ç–∫—É
		var lastNote *models.URLNote
		if len(p.Notes) > 0 {
			lastNote = &p.Notes[len(p.Notes)-1]
		}

		if lastNote == nil {
			continue
		}

		patternStr := fmt.Sprintf("- %s (confidence: %.2f)", p.Pattern, lastNote.Confidence)
		patternStr += fmt.Sprintf(" - %s", lastNote.Content)

		// –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ–º—É —Ç–∏–ø—É –∞—Ç–∞–∫–∏
		if strings.Contains(p.Pattern, "{") || strings.Contains(strings.ToLower(p.Pattern), "id") {
			idorPatterns = append(idorPatterns, patternStr)
		} else if strings.Contains(strings.ToLower(p.Pattern), "admin") || strings.Contains(
			strings.ToLower(p.Pattern), "auth",
		) {
			authPatterns = append(authPatterns, patternStr)
		} else if strings.Contains(
			strings.ToLower(lastNote.VulnHint), "sql",
		) || strings.Contains(strings.ToLower(lastNote.VulnHint), "injection") {
			sqlPatterns = append(sqlPatterns, patternStr)
		} else {
			otherPatterns = append(otherPatterns, patternStr)
		}
	}

	var result strings.Builder

	if len(idorPatterns) > 0 {
		result.WriteString("\n**–í–æ–∑–º–æ–∂–Ω—ã–π IDOR:**\n")
		result.WriteString(strings.Join(idorPatterns, "\n"))
	}

	if len(authPatterns) > 0 {
		result.WriteString("\n\n**–í–æ–∑–º–æ–∂–Ω—ã–π Broken Access Control:**\n")
		result.WriteString(strings.Join(authPatterns, "\n"))
	}

	if len(sqlPatterns) > 0 {
		result.WriteString("\n\n**–í–æ–∑–º–æ–∂–Ω—ã–π SQL/NoSQL Injection:**\n")
		result.WriteString(strings.Join(sqlPatterns, "\n"))
	}

	if len(otherPatterns) > 0 {
		result.WriteString("\n\n**–î—Ä—É–≥–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**\n")
		result.WriteString(strings.Join(otherPatterns, "\n"))
	}

	if result.Len() == 0 {
		return "–ù–µ—Ç —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤"
	}

	return result.String()
}

// formatSuspiciousPatterns —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
func formatSuspiciousPatterns(patterns []*models.URLPattern) string {
	if len(patterns) == 0 {
		return "–ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é"
	}

	var result strings.Builder
	for i, p := range patterns {
		// –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–º–µ—Ç–∫—É
		var lastNote *models.URLNote
		if len(p.Notes) > 0 {
			lastNote = &p.Notes[len(p.Notes)-1]
		}

		if lastNote == nil || lastNote.Confidence < 0.7 {
			continue // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–∏–∑–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ
		}

		result.WriteString(fmt.Sprintf("\n%d. URL Pattern: %s\n", i+1, p.Pattern))
		result.WriteString(fmt.Sprintf("   –ó–∞–º–µ—Ç–∫–∞: %s\n", lastNote.Content))
		result.WriteString(
			fmt.Sprintf(
				"   –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: %v (confidence: %.2f)\n", lastNote.Suspicious, lastNote.Confidence,
			),
		)
		if lastNote.VulnHint != "" {
			result.WriteString(fmt.Sprintf("   –ü–æ–¥—Å–∫–∞–∑–∫–∞: %s\n", lastNote.VulnHint))
		}
	}

	if result.Len() == 0 {
		return "–ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å confidence >= 0.7"
	}

	return result.String()
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω—ã (formatTechList, formatTechStackCompact) - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã

// BuildVerificationPlanPrompt —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
func BuildVerificationPlanPrompt(req *models.VerificationPlanRequest) string {
	return fmt.Sprintf(
		`–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥–∏–ø–æ—Ç–µ–∑—ã –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç–∏.

–ì–ò–ü–û–¢–ï–ó–ê:
%s

–û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –ó–ê–ü–†–û–°:
URL: %s
–ú–µ—Ç–æ–¥: %s
Status: %d

–ö–û–ù–¢–ï–ö–°–¢:
%s

–ó–ê–î–ê–ß–ê:
–°–æ–∑–¥–∞–π –ø–ª–∞–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —ç—Ç–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã —á–µ—Ä–µ–∑ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ GET –∑–∞–ø—Ä–æ—Å—ã.

–ü–†–ê–í–ò–õ–ê:
1. –¢–æ–ª—å–∫–æ GET –∑–∞–ø—Ä–æ—Å—ã (–Ω–∏–∫–∞–∫–∏—Ö POST/PUT/DELETE)
2. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ %d –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
3. –°–æ–∑–¥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ URL —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
4. –û–±—ä—è—Å–Ω–∏ –ª–æ–≥–∏–∫—É –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
{
  "test_requests": [
    {
      "url": "–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏",
      "method": "GET",
      "headers": {"Header-Name": "Header-Value"},
      "body": "–ï—Å–ª–∏ –Ω—É–∂–Ω–æ",
      "purpose": "—á—Ç–æ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç"
    }
  ],
  "reasoning": "–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω—ã —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã"
}

–û–¢–í–ï–¢ –í JSON:`,
		req.Hypothesis,
		req.TargetURL,
		req.OriginalRequest.Method,
		req.OriginalRequest.StatusCode,
		req.AdditionalInfo,
		req.MaxAttempts,
	)
}

// BuildVerificationAnalysisPrompt —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
func BuildVerificationAnalysisPrompt(req *models.VerificationAnalysisRequest) string {
	resultsJSON, _ := json.MarshalIndent(req.TestResults, "", "  ")

	return fmt.Sprintf(
		`–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥–∏–ø–æ—Ç–µ–∑—ã.

–ò–°–•–û–î–ù–ê–Ø –ì–ò–ü–û–¢–ï–ó–ê:
%s

–ò–°–•–û–î–ù–ê–Ø –£–í–ï–†–ï–ù–ù–û–°–¢–¨: %.2f

–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–û–ö:
%s

–ê–ù–ê–õ–ò–ó:
–ù–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ –æ–ø—Ä–µ–¥–µ–ª–∏:

1. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –ª–∏ —É—è–∑–≤–∏–º–æ—Å—Ç—å** (—Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å)
2. **–°–∫–æ—Ä–µ–µ –ª–æ–∂–Ω—ã–π —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ** (–≤—Å–µ –æ—Ç–≤–µ—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ)
3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö** (–Ω–µ–ª—å–∑—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑ GET –∑–∞–ø—Ä–æ—Å–æ–≤)

–ö–†–ò–¢–ï–†–ò–ò –ê–ù–ê–õ–ò–ó–ê:
- –†–∞–∑–Ω—ã–µ status codes = –≤–æ–∑–º–æ–∂–Ω–æ —É—è–∑–≤–∏–º–æ
- –†–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ = –≤–æ–∑–º–æ–∂–Ω–æ —É—è–∑–≤–∏–º–æ
- –†–∞–∑–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ = —Å–∫–æ—Ä–µ–µ —É—è–∑–≤–∏–º–æ
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã = —Å–∫–æ—Ä–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
{
  "status": "verified|likely_false|inconclusive|manual_check",
  "updated_confidence": 0.0-1.0,
  "reasoning": "–¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ—á–µ–º—É —Å–¥–µ–ª–∞–Ω —Ç–∞–∫–æ–π –≤—ã–≤–æ–¥",
  "recommended_poc": "–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π POC –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ"
}

–û–¢–í–ï–¢ –í JSON:`,
		req.Hypothesis,
		req.OriginalConfidence,
		string(resultsJSON),
	)
}

// BuildBatchVerificationPrompt —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –±–∞—Ç—á–∏–Ω–≥–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö findings –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
func BuildBatchVerificationPrompt(req *models.BatchVerificationRequest) string {
	// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º findings –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
	findingsJSON := formatJSON(req.Findings)

	return fmt.Sprintf(
		`–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–µ–Ω—Ç–µ—Å—Ç–µ—Ä–∞ –Ω–∞ CTF/Bug Bounty.

### –ö–û–ù–¢–ï–ö–°–¢:
–ù—É–∂–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å %d findings –¥–ª—è –æ–¥–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞.

Original Request:
- URL: %s
- Method: %s
- Status Code: %d

### FINDINGS –î–õ–Ø –ü–†–û–í–ï–†–ö–ò:
%s

### –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–û–í:
%s

### –ó–ê–î–ê–ß–ê:
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ findings –∏ –æ–ø—Ä–µ–¥–µ–ª–∏ —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤.

### –ò–ù–°–¢–†–£–ö–¶–ò–ò:
1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ finding —Å—Ä–∞–≤–Ω–∏ –í–°–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–º–∞—Å—Å–∏–≤ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤):
   - Original response vs Test responses
   - Status codes –†–ê–ó–ù–´–• —Ç–µ—Å—Ç–æ–≤
   - Response sizes
   - Response content

2. –û–ø—Ä–µ–¥–µ–ª–∏ —Å—Ç–∞—Ç—É—Å (–Ω–∞ –æ—Å–Ω–æ–≤–µ –í–°–ï–• —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ finding):
   - "verified" - —è–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (—Ö–æ—Ç—è –±—ã –≤ –û–î–ù–û–ú —Ç–µ—Å—Ç–µ)
   - "likely_true" - —Å–∫–æ—Ä–µ–µ —É—è–∑–≤–∏–º–æ (70%%+ —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫–∞–∑–∞–ª–∏ —É—è–∑–≤–∏–º–æ—Å—Ç—å,
     –∏–ª–∏ –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–∞—ë—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å >0.7)
   - "likely_false" - —Å–∫–æ—Ä–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ (–í–°–ï —Ç–µ—Å—Ç—ã –ø–æ–∫–∞–∑–∞–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
   - "inconclusive" - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å (–ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)

3. –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å, –¥—Ä—É–≥–∏–µ –Ω–µ—Ç),
   –¥–∞–π –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ –ø–æ—á–µ–º—É –∏ –∫–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å –≤—ã–±—Ä–∞–Ω.

4. –ï—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π (–ø–æ–ª–µ Error –Ω–µ –ø—É—Å—Ç–æ–µ),
   —É—á–∏—Ç—ã–≤–∞–π —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã. –ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã —Å –æ—à–∏–±–∫–æ–π ‚Üí inconclusive.

5. –ï—Å–ª–∏ —Ä–∞–∑–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –≤–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏
   (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–Ω—ã–µ NoSQLi –ø–µ–π–ª–æ–∞–¥—ã), —É—á–∏—Ç—ã–≤–∞–π —ç—Ç–æ –≤ –æ—Ü–µ–Ω–∫–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.

6. –î–∞–π —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ finding

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–û–†–ú–ê–¢ JSON:
–û–¢–í–ï–¢ –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –°–¢–†–û–ì–û –í–ê–õ–ò–î–ù–´–ú JSON –ë–ï–ó –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ì–û –¢–ï–ö–°–¢–ê!
- –ù–ï –¥–æ–±–∞–≤–ª—è–π markdown –∫–æ–¥ –±–ª–æ–∫–∏
- –ù–ï –¥–æ–±–∞–≤–ª—è–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ JSON
- –ù–ï –¥–æ–±–∞–≤–ª—è–π trailing commas –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è —Å—Ç—Ä–æ–∫
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –≤ —Å—Ç—Ä–æ–∫–∞—Ö –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- boolean –∑–Ω–∞—á–µ–Ω–∏—è: true –∏–ª–∏ false –±–µ–∑ –∫–∞–≤—ã—á–µ–∫
- numbers: 0.85 –±–µ–∑ –∫–∞–≤—ã—á–µ–∫
- –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã

### –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê –í JSON:
{
  "batch_results": [
    {
      "finding_index": 0,
      "status": "verified",
      "confidence": 0.9,
      "reasoning": "–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤"
    }
  ]
}

–í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON –æ–±—ä–µ–∫—Ç–æ–º –≤—ã—à–µ, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ!

–û–¢–í–ï–¢ –í JSON:`,
		len(req.Findings),
		req.OriginalRequest.URL,
		req.OriginalRequest.Method,
		req.OriginalRequest.StatusCode,
		findingsJSON,
		string(formatJSON(req.TestResults)),
	)
}
